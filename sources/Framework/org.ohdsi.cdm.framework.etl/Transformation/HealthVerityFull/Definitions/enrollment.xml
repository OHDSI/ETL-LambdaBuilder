<QueryDefinition>
  <Query>
	with a as
		(
		select
		ch.person_id as PersonId,
		hvid,
		date_start,
		date_end,
		payer_type,
		benefit_type,
		case when lower(payer_type) = 'medicaid'
		   then 289
		   when lower(payer_type) = 'commercial'
		   then 327
		   when lower(payer_type) IN ('medicare', 'medicare advantage') 
		   then 281
		   else 0
		end as payer_concept_id,
		case when lower(benefit_type) = 'medical'
			 then 270
		   when lower(benefit_type) = 'pharmacy'
		   then 273
		   else 0
		end as plan_concept_id
		FROM {sc}.enrollment
		  JOIN {ch_sc}._chunks ch ON ch.ChunkId = {0} AND hvid = ch.PERSON_SOURCE_VALUE
		)
		select
		  a.*
		from a
	</Query>
  <PayerPlanPeriods>
    <PayerPlanPeriodDefinition>
		<PersonId>PersonId</PersonId>
		<StartDate>date_start</StartDate>
		<EndDate>date_end</EndDate>
      <Concepts>
        <Concept>
          <Fields>
            <Field conceptId="payer_concept_id" key="payer_type" sourceKey="payer_type" defaultTypeId="0"/>
          </Fields>
        </Concept>
        <Concept>
          <Fields>
            <Field conceptId="plan_concept_id" key="benefit_type" sourceKey="benefit_type" defaultTypeId="0"/>
          </Fields>
        </Concept>
      </Concepts>
    </PayerPlanPeriodDefinition>
  </PayerPlanPeriods>
</QueryDefinition>