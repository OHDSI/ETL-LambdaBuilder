<QueryDefinition>
  <Query>
	with a as
		(
		select
		ch.person_id as PersonId,
		hvid,
		date_start,
		date_end,
		payer_type,
		benefit_type,
		case when lower(payer_type) = 'medicaid'
		   then 289
		   when lower(payer_type) = 'commercial'
		   then 327
		   when lower(payer_type) IN ('medicare', 'medicare advantage') 
		   then 281
		   else 0
		end as payer_concept_id,
		case when lower(benefit_type) = 'medical'
			 then 270
		   when lower(benefit_type) = 'pharmacy'
		   then 273
		   else 0
		end as plan_concept_id
		FROM {sc}.enrollment
		  JOIN {ch_sc}._chunks ch ON ch.ChunkId = {0} AND hvid = ch.PERSON_SOURCE_VALUE
		)
		select
		  a.*
		from a
	</Query>
  <PayerPlanPeriods>
    <PayerPlanPeriodDefinition>
		<PersonId>PersonId</PersonId>
		<StartDate>date_start</StartDate>
		<EndDate>date_end</EndDate>
		<PayerConceptId>payer_concept_id</PayerConceptId>
		<PayerSourceValue>payer_type</PayerSourceValue>
		<PayerSourceConceptId>0</PayerSourceConceptId>
		<PlanConceptId>plan_concept_id</PlanConceptId>
		<PlanSourceValue>benefit_type</PlanSourceValue>
		<PlanSourceConceptId>0</PlanSourceConceptId>
    </PayerPlanPeriodDefinition>
  </PayerPlanPeriods>
</QueryDefinition>